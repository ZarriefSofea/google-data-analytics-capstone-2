---
title: "Case2"
author: "Zarrief Sofea"
date: "2023-11-25"
output: html_document
---



## Part 1: Loading Data

### **Setting up R envirnment **

```{r}
library(tidyverse)
library(lubridate)
library(tidyr)
library(dplyr)
library(ggplot2)
library(patchwork)
```
# Import and merge all three CSV files into one data frame

```{r}
setwd("C:/Users/zarri/OneDrive/Documents/Coursera/Case1/raw_data")

df1 <- list.files("C:/Users/zarri/OneDrive/Documents/Coursera/Case1/raw_data") %>% 
  lapply(read_csv) %>% 
  bind_rows
```

# Preview dataset

```{r}
summary(df1)
colnames(df1)
head(df1)
glimpse(df1)
```




### Part 2: Data Cleaning



# Checking typo in categorical col.

unique(df1$rideable_type)
unique(df1$member_casual)

# Checking missing values

emptyCells <- sapply(df1, function(x)
  sum(is.na(x)))
print(emptyCells)

# Checking duplicate rows

duplicates <- df1[duplicated(df1), ]

duplicate_counts <- table(df1[duplicated(df1), ])

duplicates

duplicate_counts

# Change datetimes col. types to format that we want.

df1 <- df1 %>% 
  mutate(started_at = as_datetime(started_at)) %>% 
  mutate(ended_at = as_datetime(ended_at))

# note desired data types, now we can just use subtraction to get ride duration

# Now create new. col named "ride_length"
# subtraction operator method for <dttm> produces durations

df2 <- df1 %>%
  mutate(ride_length = difftime(ended_at, started_at, units = "mins"))

# Convert ride_length to numeric format
df2$ride_length <-
  as.numeric(as.character(df2$ride_length))
is.numeric(df2$ride_length) #returns TRUE if ride_length is already numeric
# Checking for the min and max value in ride_length column

max(df2$ride_length)
min(df2$ride_length) #since we got negative mins we must remove it

# Removing bad ride_length data (ride length must be at least 1 min but not more than 24 hours or 1440 minutes.)

df2 = df2 %>%
  filter(between(ride_length, 1, 1440))
bad_data <- nrow(df1) - nrow(df2)
paste0("There are a total of ", bad_data , " bad data removed ")

#Lastly create col named "hour_start", "month","day_of_week"

df2$day_of_week <- weekdays(as.Date(df2$started_at))

df2 <- df2 %>%
  mutate(
    hour_start = hour(started_at),
    month = month(started_at, label = T, abbr = F),
    day_of_week = wday(started_at, label = T, abbr = F))

# Checking the cleaned data
glimpse(df2)
View(df2)

### Part 3: Analyze

#Calculating for the mean and median values of ride_length

mean_ridelength_member <-
  mean(df2$ride_length[df2$member_casual == "member"], na.rm = TRUE)

paste0("Members mean length of ride is ", mean_ridelength_member)

mean_ridelength_casual <-
  mean(df2$ride_length[df2$member_casual == "casual"], na.rm = TRUE)

paste0("Casuals mean length of ride is ", mean_ridelength_casual)

# Find the overall median of ride length as well as among annual members & casual riders.

median_ridelength_member <-
  median(df2$ride_length[df2$member_casual == "member"], na.rm = TRUE)

paste0("Members median length of ride is ", median_ridelength_member)

median_ridelength_casual <-
  median(df2$ride_length[df2$member_casual == "casual"], na.rm = TRUE)

paste0("Casuals median length of ride is ", median_ridelength_casual)

# Find the overall maximum of ride length as well as among annual members & casual riders.

max_ridelength_member <-
  max(df2$ride_length[df2$member_casual == "member"], na.rm = TRUE)

paste0("Members max length of ride is ", max_ridelength_member)

max_ridelength_casual <-
  max(df2$ride_length[df2$member_casual == "casual"], na.rm = TRUE)

paste0("Casuals max length of ride is ", max_ridelength_casual)

# Find the overall manimum of ride length as well as among annual members & casual riders.

min_ridelength_member <-
  min(df2$ride_length[df2$member_casual == "member"], na.rm = TRUE)

paste0("Members min length of ride is ", min_ridelength_member)

min_ridelength_casual <-
  min(df2$ride_length[df2$member_casual == "casual"], na.rm = TRUE)

paste0("Casuals min length of ride is ", min_ridelength_casual)


#Analysis 1: Casual riders have greater mean and median ride lengths than annual members, while having similar minimum and maximum ride lengths.



# Total number of rides among annual members and casual riders
customer_totalrides <- df2 %>%
  group_by(member_casual) %>%
  dplyr::summarise(number_of_rides = n())
customer_totalrides

#Analysis 2: Annual members have the highest number of rides compared to casual riders from January 2022 - January 2023



#Most Popular Starting Hours among annual members and casual riders
peak_hour <-df2 %>%
  group_by(member_casual, hour_start) %>%
  dplyr::summarise(number_of_rides = n(), .groups = "drop") 
peak_hour

#Analysis 4: Most annual members and casual riders prefer to begin their rides between 4PM and 6PM, with the peak time for riding bikes being at 5PM.



#Most Popular Day of the Week among annual members and casual riders

peak_day <-df2 %>%
  group_by(member_casual, day_of_week) %>%
  dplyr::summarise(number_of_rides = n(), .groups = "drop")
peak_day

peak_day_ridelength <-df2 %>%
  group_by(member_casual, day_of_week) %>%
  dplyr::summarise(mean_ridelength = mean(ride_length), .groups = "drop")
peak_day_ridelength

#Analysis 5: Annual members have the most number of rides during Wednesdays and Thursdays, while casual riders have less and mostly prefer to ride bikes during weekends. Casual riders have a significantly longer rides than annual members in all days of the week, with Sunday being the longest of the week.




#Most Popular Month among annual members and casual riders
peak_month <-df2 %>%
  group_by(member_casual, month) %>%
  dplyr::summarise(number_of_rides = n(), .groups = "drop")
peak_month

peak_month_ridelength <-df2 %>%
  group_by(member_casual, month) %>%
  dplyr::summarise(mean_ride_length = mean(ride_length), .groups = "drop")
peak_month_ridelength 

#Analysis 6
#The month of June records the highest number of rides for both type of memnbership
#The month of June record the longest rides of members while the month of May is the longest for casual riders



### Part 3: Data Vizualization

#Visualize the mean and median values of ride_length of between customer type

chart1 <-
  df2 %>%
  group_by(member_casual) %>%
  dplyr::summarise(mean_ride_length = mean(ride_length),.groups = "drop") %>%
  ggplot(aes(x = member_casual,
             y = mean_ride_length,
             fill = member_casual)) +
  geom_col(width = 0.4, position = position_dodge(width = 0.5))+
  ggtitle("Annual Members vs. Casual Riders\n Total Mean Ride Lengths (Minutes)")
  

chart2 <-
  df2 %>%
  group_by(member_casual) %>%
  dplyr::summarise(median_ride_length = median(ride_length),.groups = "drop") %>%
  ggplot(aes(x = member_casual,
             y = median_ride_length,
             fill = member_casual)) +
  geom_col(width = 0.4, position = position_dodge(width = 0.5))+ggtitle("Annual Members vs. Casual Riders\n Total Mean Ride Lengths (Minutes)")



chart1 + chart2
  

#Visualize the relation between customers type and readable type using ggplot to see each customer bike preferences and also to know which ride type is used more often

chart3 <- 
  df2 %>%
    group_by(member_casual,rideable_type) %>% 
    dplyr::summarise(number_of_rides = n(), .groups = "drop") %>% 
    ggplot(aes(x=member_casual,y=number_of_rides,fill=member_casual))+
    geom_col(position = "dodge")+
    scale_y_continuous(labels = scales::comma)+
    ggtitle("Member type vs rideable_type") + 
    facet_grid(cols = vars(rideable_type),             
      scales = "free_x",
      space = "free_x")

chart3

# Visualizing the number of rides each customer type made at every hour of the day

chart4 <- df2 %>%
  group_by(member_casual, hour_start) %>%
  dplyr::summarise(number_of_rides = n(), .groups = "drop") %>%
  ggplot(aes(x = hour_start, y = number_of_rides, col = member_casual)) + geom_point (alpha = 0.5, size = 2) +
  scale_y_continuous(n.breaks = 12) +
  scale_x_continuous(n.breaks = 24) +
  geom_smooth()

chart4


# Vizualize the total number of rides segmented by days

chart5 <- df2 %>%
  group_by(member_casual, hour_start, day_of_week) %>%
  dplyr::summarise(number_of_rides = n(), .groups = "drop") %>%
  ggplot(aes(x = hour_start, y = number_of_rides, col = member_casual)) + geom_point (size = 1) +
  labs(
    title = paste(
      "Annual Members vs. Casual Riders",
      sep = "\n",
      "Total Number of Rides Segmented by Days of the Week and\nStart Riding Hours of the Day"))+
  facet_wrap(.~day_of_week)+
  geom_smooth()

chart5

# Visualizing the average ride length of the customers types each month,day and hour

chart6 <- df2 %>% 
  group_by(member_casual, month) %>% 
  summarise(number_of_rides = n()
            ,average_duration = mean(ride_length)) %>% 
  arrange(member_casual, month)  %>% 
  ggplot(aes(x = month, y = average_duration, fill = member_casual)) +
  geom_col(position = "dodge") +ggtitle("Average rides length by rider type during each month")

chart6

chart7 <- df2 %>% 
  group_by(member_casual, day_of_week) %>% 
  summarise(number_of_rides = n()
            ,average_duration = mean(ride_length)) %>% 
  arrange(member_casual, day_of_week)  %>% 
  ggplot(aes(x = day_of_week, y = average_duration, fill = member_casual)) +
  geom_col(position = "dodge") +ggtitle("Average rides length by rider type during each day")

chart7

chart8 <- df2 %>%
  group_by(member_casual, hour_start, day_of_week) %>%
  dplyr::summarise(number_of_rides = n(),
                   average_duration = mean(ride_length), .groups = "drop") %>%
  ggplot(aes(x = hour_start, y = average_duration, col = member_casual)) + geom_point (size = 1) +
  labs(
    title = paste(
      "Annual Members vs. Casual Riders",
      sep = "\n",
      "Total Number of Rides Segmented by Days of the Week and\nStart Riding Hours of the Day"))+
  facet_wrap(.~day_of_week)+
  geom_smooth()  
 

chart8


  
  
df2 %>%   
group_by(member_casual,hours) %>% 
  summarise(number_of_rides = n(),
            average_duration = mean(ride_length)) %>% 
  ggplot(aes(x = hours, y = average_duration, fill = member_casual))+
  geom_col(position = "dodge")+ggtitle("Average rides length by rider type during the day")


